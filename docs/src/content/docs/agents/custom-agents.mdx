---
title: Custom Agents
description: A guide to creating custom agents in the Multi-Agent Orchestrator System, including various examples
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

The `Agent` abstract class provides a flexible foundation for creating various types of agents. When implementing a custom agent, you can:

1. **Call Language Models**: Integrate with LLMs like GPT-3, BERT, or custom models.
2. **API Integration**: Make calls to external APIs or services.
3. **Data Processing**: Implement data analysis, transformation, or generation logic.
4. **Rule-Based Systems**: Create agents with predefined rules and responses.
5. **Hybrid Approaches**: Combine multiple techniques for more complex behaviors.

## Basic Structure of a Custom Agent

To create a custom agent, you need to extend the base `Agent` class or one of its subclasses. Here's the basic structure:

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    import { Agent, AgentOptions, Message } from './path-to-agent-module';

    class CustomAgent extends Agent {
      constructor(options: AgentOptions) {
        super(options);
        // Additional initialization if needed
      }

      async processRequest(
        inputText: string,
        userId: string,
        sessionId: string,
        chatHistory: Message[],
        additionalParams?: Record<string, any>
      ): Promise<Message> {
        // Implement your custom logic here
      }
    }
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    from typing import List, Dict, Any, Optional
    from .agent import Agent
    from .types import AgentOptions, Message

    class CustomAgent(Agent):
        def __init__(self, options: AgentOptions):
            super().__init__(options)
            # Additional initialization if needed

        async def process_request(
            self,
            input_text: str,
            user_id: str,
            session_id: str,
            chat_history: List[Message],
            additional_params: Optional[Dict[str, Any]] = None
        ) -> Message:
            # Implement your custom logic here
            pass
    ```
  </TabItem>
</Tabs>

## Examples of Custom Agents

### 1. Simple Greeting Agent

This is a basic example of a custom agent that simply greets the user:

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    class SimpleGreetingAgent extends Agent {
      async processRequest(
        inputText: string,
        userId: string,
        sessionId: string,
        chatHistory: Message[]
      ): Promise<Message> {
        return {
          role: 'assistant',
          content: [{ text: `Hello! You said: ${inputText}` }]
        };
      }
    }

    // Usage
    const greetingAgent = new SimpleGreetingAgent({
      name: 'Greeting Agent',
      description: 'A simple agent that greets users'
    });

    orchestrator.addAgent(greetingAgent);
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    from .agent import Agent
    from .types import Message, Role

    class SimpleGreetingAgent(Agent):
        async def process_request(
            self,
            input_text: str,
            user_id: str,
            session_id: str,
            chat_history: List[Message]
        ) -> Message:
            return {
                'role': Role.ASSISTANT,
                'content': [{'text': f"Hello! You said: {input_text}"}]
            }

    # Usage
    greeting_agent = SimpleGreetingAgent(AgentOptions(
        name='Greeting Agent',
        description='A simple agent that greets users'
    ))

    orchestrator.add_agent(greeting_agent)
    ```
  </TabItem>
</Tabs>

### 2. API-based Agent (OpenAI example)

This example shows how to create an agent that uses an external API (in this case, OpenAI):

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    import { Configuration, OpenAIApi } from 'openai';

    class OpenAIAgent extends Agent {
      private openai: OpenAIApi;

      constructor(options: AgentOptions & { apiKey: string }) {
        super(options);
        const configuration = new Configuration({ apiKey: options.apiKey });
        this.openai = new OpenAIApi(configuration);
      }

      async processRequest(
        inputText: string,
        userId: string,
        sessionId: string,
        chatHistory: Message[]
      ): Promise<Message> {
        const response = await this.openai.createCompletion({
          model: 'text-davinci-002',
          prompt: inputText,
          max_tokens: 150
        });

        return {
          role: 'assistant',
          content: [{ text: response.data.choices[0].text || 'No response' }]
        };
      }
    }

    // Usage
    const openAIAgent = new OpenAIAgent({
      name: 'OpenAI Agent',
      description: 'An agent that uses OpenAI API for responses',
      apiKey: 'your-openai-api-key'
    });

    orchestrator.addAgent(openAIAgent);
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    import openai
    from .agent import Agent
    from .types import Message, Role, AgentOptions

    class OpenAIAgent(Agent):
        def __init__(self, options: AgentOptions, api_key: str):
            super().__init__(options)
            openai.api_key = api_key

        async def process_request(
            self,
            input_text: str,
            user_id: str,
            session_id: str,
            chat_history: List[Message]
        ) -> Message:
            response = openai.Completion.create(
                engine="text-davinci-002",
                prompt=input_text,
                max_tokens=150
            )

            return {
                'role': Role.ASSISTANT,
                'content': [{'text': response.choices[0].text.strip() or 'No response'}]
            }

    # Usage
    openai_agent = OpenAIAgent(
        AgentOptions(
            name='OpenAI Agent',
            description='An agent that uses OpenAI API for responses'
        ),
        api_key='your-openai-api-key'
    )

    orchestrator.add_agent(openai_agent)
    ```
  </TabItem>
</Tabs>

### 3. Streaming Agent

This example demonstrates how to create an agent that streams its response:

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    class StreamingAgent extends Agent {
      async *processRequest(
        inputText: string,
        userId: string,
        sessionId: string,
        chatHistory: Message[]
      ): AsyncIterable<any> {
        const words = inputText.split(' ');
        for (const word of words) {
          yield { role: 'assistant', content: [{ text: word + ' ' }] };
          await new Promise(resolve => setTimeout(resolve, 500)); // Simulate delay
        }
      }
    }

    // Usage
    const streamingAgent = new StreamingAgent({
      name: 'Streaming Agent',
      description: 'An agent that streams responses word by word'
    });

    orchestrator.addAgent(streamingAgent);

    // Example usage of streaming response
    const streamingResponse = await orchestrator.routeRequest('Hello, streaming world!', 'user123', 'session456');
    for await (const chunk of streamingResponse) {
      console.log(chunk);
    }
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    import asyncio
    from .agent import Agent
    from .types import Message, Role, AgentOptions

    class StreamingAgent(Agent):
        async def process_request(
            self,
            input_text: str,
            user_id: str,
            session_id: str,
            chat_history: List[Message]
        ) -> AsyncIterable[Message]:
            words = input_text.split()
            for word in words:
                yield {
                    'role': Role.ASSISTANT,
                    'content': [{'text': word + ' '}]
                }
                await asyncio.sleep(0.5)  # Simulate delay

    # Usage
    streaming_agent = StreamingAgent(AgentOptions(
        name='Streaming Agent',
        description='An agent that streams responses word by word'
    ))

    orchestrator.add_agent(streaming_agent)

    # Example usage of streaming response
    async for chunk in orchestrator.route_request('Hello, streaming world!', 'user123', 'session456'):
        print(chunk)
    ```
  </TabItem>
</Tabs>

### 4. Agent with External API Integration

This example shows how to create an agent that integrates with an external API to provide stock price information:

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    import axios from 'axios';

    class StockPriceAgent extends Agent {
      private apiKey: string;

      constructor(options: AgentOptions & { apiKey: string }) {
        super(options);
        this.apiKey = options.apiKey;
      }

      async processRequest(
        inputText: string,
        userId: string,
        sessionId: string,
        chatHistory: Message[]
      ): Promise<Message> {
        const stockSymbol = this.extractStockSymbol(inputText);
        if (!stockSymbol) {
          return {
            role: 'assistant',
            content: [{ text: 'I\'m sorry, I couldn\'t identify a stock symbol in your request.' }]
          };
        }

        try {
          const price = await this.getStockPrice(stockSymbol);
          return {
            role: 'assistant',
            content: [{ text: `The current price of ${stockSymbol} is $${price}.` }]
          };
        } catch (error) {
          return {
            role: 'assistant',
            content: [{ text: 'I\'m sorry, I couldn\'t retrieve the stock price at this time.' }]
          };
        }
      }

      private extractStockSymbol(input: string): string | null {
        // Simple extraction, could be improved with NLP
        const match = input.match(/\b[A-Z]{1,5}\b/);
        return match ? match[0] : null;
      }

      private async getStockPrice(symbol: string): Promise<number> {
        const response = await axios.get(`https://finance-api.example.com/price/${symbol}?apikey=${this.apiKey}`);
        return response.data.price;
      }
    }

    // Usage
    const stockAgent = new StockPriceAgent({
      name: 'Stock Price Agent',
      description: 'An agent that provides current stock prices',
      apiKey: 'your-finance-api-key'
    });

    orchestrator.addAgent(stockAgent);
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    import re
    import aiohttp
    from .agent import Agent
    from .types import Message, Role, AgentOptions

    class StockPriceAgent(Agent):
        def __init__(self, options: AgentOptions, api_key: str):
            super().__init__(options)
            self.api_key = api_key

        async def process_request(
            self,
            input_text: str,
            user_id: str,
            session_id: str,
            chat_history: List[Message]
        ) -> Message:
            stock_symbol = self.extract_stock_symbol(input_text)
            if not stock_symbol:
                return {
                    'role': Role.ASSISTANT,
                    'content': [{'text': "I'm sorry, I couldn't identify a stock symbol in your request."}]
                }

            try:
                price = await self.get_stock_price(stock_symbol)
                return {
                    'role': Role.ASSISTANT,
                    'content': [{'text': f"The current price of {stock_symbol} is ${price:.2f}."}]
                }
            except Exception:
                return {
                    'role': Role.ASSISTANT,
                    'content': [{'text': "I'm sorry, I couldn't retrieve the stock price at this time."}]
                }

        @staticmethod
        def extract_stock_symbol(input_text: str) -> str | None:
            # Simple extraction, could be improved with NLP
            match = re.search(r'\b[A-Z]{1,5}\b', input_text)
            return match.group(0) if match else None

        async def get_stock_price(self, symbol: str) -> float:
            async with aiohttp.ClientSession() as session:
                async with session.get(f"https://finance-api.example.com/price/{symbol}?apikey={self.api_key}") as response:
                    data = await response.json()
                    return data['price']

    # Usage
    stock_agent = StockPriceAgent(
        AgentOptions(
            name='Stock Price Agent',
            description='An agent that provides current stock prices'
        ),
        api_key='your-finance-api-key'
    )

    orchestrator.add_agent(stock_agent)
    ```
  </TabItem>
</Tabs>

These examples demonstrate various ways to implement custom agents, from simple text-based responses to integration with external APIs and streaming capabilities. By leveraging these patterns, you can create agents tailored to your specific use cases within the Multi-Agent Orchestrator system.
